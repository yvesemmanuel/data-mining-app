{% extends "layout.html" %} {% block body %}

<div class="container">
    <h1 class="title section-title">{{page_title}}</h1>

    <hr>

    <form method="post">
        <div class="row justify-content-center">

            <div class="col-sm-4 form-group">
                <label class="input-title" for="entity">Tipo de Fornecedor</label>
                <select class="form-control" id="entity" name="entity" {% if user_request=="POST" %}
                    onchange="document.getElementById('apply').click()" {% endif %}>
                    {% for entity in options_entity %}
                    <option value="{{ entity }}" {% if selected_entity==entity %} selected {% endif %}>{{
                        entity }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-sm-4 form-group">
                <label class="input-title" for="year">Ano</label>
                <select class="form-control" id="year" name="year" {% if user_request=="POST" %}
                    onchange="document.getElementById('apply').click()" {% endif %}>
                    {% for year in options_year %}
                    <option value="{{ year }}" {% if selected_year==year %} selected {% endif %}>{{
                        year }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="row justify-content-center" style="margin-top: 9px;">

            <div class="col-sm-4 form-group">
                <label class="input-title" for="limit">Limite de Atraso</label>
                <select class="form-control" id="limit" name="limit" {% if user_request=="POST" %}
                    onchange="document.getElementById('apply').click()" {% endif %}>
                    {% for limit in options_limit %}
                    <option value="{{ limit }}" {% if selected_limit==limit %} selected {% endif %}>{{
                        limit }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-sm-4 form-group">
                <label class="input-title" for="loan_type">Tipo de Empenho</label>
                <select class="form-control" id="loan_type" name="loan_type" {% if user_request=="POST" %}
                    onchange="document.getElementById('apply').click()" {% endif %}>
                    {% for loan_type in options_loan_type %}
                    <option value="{{ loan_type }}" {% if selected_loan_type==loan_type %} selected {% endif %}>{{ loan_type }}
                    </option>
                    {% endfor %}
                </select>
            </div>

        </div>

        {% if user_request == "GET" %}
        <div class="text-center">
            <button class="btn btn-default btn-md button-style" type="submit" name="action" value="apply"
                id="apply">Aplicar</button>
        </div>
        {% elif user_request == "POST" %}
        <div class="text-center hidden">
            <button class="btn btn-default btn-md button-style" type="submit" name="action" value="apply"
                id="apply">Aplicar</button>
        </div>
        {% endif %}

        {% if user_request == 'POST' %}
        <iframe class="map col-lg-12 col-md-12 col-sm-12 col-12 .col-xl-12" height="440" srcdoc="{{selected_map}}"
            style="margin-top: 20px;"></iframe>
        {% endif %}

        {% if user_request == 'POST' %}
        <div class="row justify-content-center">

            <div class="col-sm-4 form-group">
                <label class="input-title" for="city">Unidade Jurisdicionada</label>
                <select class="form-control" id="city" name="city" {% if user_request=="POST" and
                    selected_action=="update" %} onchange="document.getElementById('update').click()" {% endif %}>
                    {% for city in options_city %}
                    <option value="{{ city }}" {% if selected_city==city %} selected {% endif %}>{{ city }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            {% if selected_action == "update" %}
            <div class="col-sm-8 form-group">
                <label class="input-title" for="loan">Empenho</label>
                <select class="form-control" id="loan" name="loan" {% if user_request=="POST" and
                    selected_action=="update" %} onchange="document.getElementById('update').click()" {% endif %}>
                    {% for loan in options_loan %}
                    <option value="{{ loan }}" {% if selected_loan==loan %} selected {% endif %}>{{
                        loan }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}
        </div>

        {% if selected_action == "update" %}
        <iframe class="map col-lg-12 col-md-12 col-sm-12 col-12 .col-xl-12" height="440" srcdoc="{{plot_data}}"></iframe>
        {% endif %}
        
        {% if selected_action != "update" %}
        <div class="text-center">
            <button class="btn btn-default btn-md button-style" type="submit" name="action" value="update"
            id="update">Atualizar</button>
        </div>
        {% else %}
        <div class="text-center hidden">
            <button class="btn btn-default btn-md button-style" type="submit" name="action" value="update"
                id="update">Atualizar</button>
        </div>
        {% endif %}

        {% endif %}
    </form>



</div>

{% endblock %}